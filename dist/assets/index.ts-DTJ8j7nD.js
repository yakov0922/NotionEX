(function(){chrome.runtime.onMessage.addListener((p,b,m)=>{if(p.action==="GET_PAGE_CONTENT"){const i=[],u=(()=>{const t=["article","main",'[role="main"]',".post-content",".article-content",".content-body",".topic-content",".entry-content","#js_content"];for(const s of t){const r=document.querySelector(s);if(r instanceof HTMLElement&&r.innerText.length>300)return r}const o=Array.from(document.querySelectorAll("div, section"));let e=document.body,n=0;return o.forEach(s=>{const r=s.querySelectorAll("p").length;r>n&&(n=r,e=s)}),e})(),d=t=>{const o=["data-original","data-src","data-actualsrc","src","srcset"];for(const e of o){const n=t.getAttribute(e);if(n){const s=n.split(" ")[0].trim();if(s.startsWith("http"))return s;if(s.startsWith("//"))return"https:"+s}}return null},g=t=>{const o=[];let e=0;Array.from(t.querySelectorAll("tr")).forEach(s=>{const r=Array.from(s.querySelectorAll("td, th"));r.length>e&&(e=r.length);const a=r.map(l=>({text:l.innerText.trim(),bold:l.tagName.toLowerCase()==="th"||l.style.fontWeight==="bold"}));o.push(a)}),o.length>0&&i.push({type:"table",table_width:e,rows:o})},h=t=>{let o=!1;if(t instanceof HTMLElement){const e=t.tagName.toLowerCase(),n=window.getComputedStyle(t);if(n.display==="none"||n.visibility==="hidden"||["script","style","nav","footer","header","aside","noscript","iframe"].includes(e)||(a=>{const l=a.id.toLowerCase(),c=a.className.toLowerCase();return!!["comment","reply","footer","header","nav","sidebar","recommend","related","advert","promo","copyright","share","social","tags","author-info","login-modal","csdn-side-toolbar","template-box","blog_footer_bottom","post_comment","post_related","reward-user","praise"].some(f=>l.includes(f)||typeof c=="string"&&c.includes(f))})(t))return;if(["p","div","section","article","li","h1","h2","h3","h4","h5","h6","blockquote","table","tr"].includes(e)&&i.push({type:"break"}),e==="table"&&t instanceof HTMLTableElement&&(g(t),o=!0),["h1","h2","h3"].includes(e)&&(i.push({type:"heading",level:parseInt(e[1]),value:t.innerText.trim()}),o=!0),e==="blockquote"&&(i.push({type:"quote",value:t.innerText.trim()}),o=!0),e==="li"&&(i.push({type:"list_item",value:t.innerText.trim()}),o=!0),e==="img"&&t instanceof HTMLImageElement){const a=d(t);a&&i.push({type:"image",value:a}),o=!0}}if(!o){if(t.nodeType===Node.TEXT_NODE){const e=t.textContent;if(e&&e.trim().length>0){let n=!1,s=null,r=t.parentElement;for(;r&&r!==u;){const l=r.tagName.toLowerCase();if(["strong","b"].includes(l)&&(n=!0),l==="a"&&!s){const c=r.href;c&&c.startsWith("http")&&(s=c)}r=r.parentElement}const a=i[i.length-1];a&&a.type==="paragraph"?a.rich_text.push({text:e,bold:n,link:s}):i.push({type:"paragraph",rich_text:[{text:e,bold:n,link:s}]})}}t.childNodes.forEach(h)}if(t instanceof HTMLElement){const e=t.tagName.toLowerCase();["p","div","section","article","li","h1","h2","h3","h4","h5","h6","blockquote","table","tr"].includes(e)&&i.push({type:"break"})}};h(u);const y=i.filter(t=>t.type!=="break");m({contentItems:y})}return!0});
})()
